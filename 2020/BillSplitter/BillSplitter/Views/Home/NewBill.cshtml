@{
    ViewData["Title"] = "New Bill";
}


<table id="PositionsTable" class="table" width="600" border="1">
    <tr>
        <th> Name</th>
        <th> Price</th>
        <th> Quantity</th>
    </tr>
</table>
<br>
<br>
<label> Name
    <input type="text" id="NewName">
</label>

<label> Price
    <input type="number" id="NewPrice">
</label>
<label> Quantity
    <input type="number" id="NewQuantity" value="1" />
</label>

<button onclick="addRow()">Add Position</button>
<br>
<button onclick="PostPositions()">Make New Bill</button>
<script type="text/javascript">
    var Positions = []
    function addRow()
    {
        // Get a reference to the table
        var tableRef = document.getElementById("PositionsTable");

        // Insert a row in the table at row index 0
       
        var Price = document.getElementById("NewPrice").value;
        var Name = document.getElementById("NewName").value;
        var Quantity = document.getElementById("NewQuantity").value

        if (Price == "" || Name == "" || Quantity == "") {
            alert("empty Price or Name");
        }
        else
        {
            var newRow = tableRef.insertRow(-1);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);

            document.getElementById("NewPrice").value = "";
            document.getElementById("NewName").value = "";
            document.getElementById("NewQuantity").value = "1";

            cell1.innerHTML = Name;
            cell2.innerHTML = Price;
            cell3.innerHTML = Quantity;

            Positions.push({ "Name": Name, "Price": parseInt(Price), "Quantity": parseInt(Quantity) });
        }
    }

    function PostPositions()
    {
        var json = JSON.stringify(Positions);
     
        (async () => {
            const rawResponse = await fetch('/Home/AddNewBill', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: json
            });
            const content = await rawResponse.json();
            window.location.href = content; 
        })();
    }
</script>